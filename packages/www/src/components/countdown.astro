---
import type { HTMLAttributes } from 'astro/types'

interface Props extends HTMLAttributes<'div'> {
  date: string
}
---

<div id="countdown-container" data-date={Astro.props.date} {...Astro.props}>
  <span id="days">_d</span>
  <span id="hours">_h</span>
  <span id="mins">_m</span>
  <span id="secs">_s</span>
  <span id="ms" class="hidden">_ms</span>
</div>
<script is:inline>
  const container = document.getElementById('countdown-container')
  const countDownDate = new Date(container.dataset.date).getTime()
  const daysElement = document.getElementById('days')
  const hoursElement = document.getElementById('hours')
  const minsElement = document.getElementById('mins')
  const secsElement = document.getElementById('secs')
  const msElement = document.getElementById('ms')

  function calculate() {
    const now = new Date().getTime()
    const timeleft = countDownDate - now

    const days = Math.floor(timeleft / (1000 * 60 * 60 * 24))
    const hours = Math.floor(
      (timeleft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60),
    )
    const minutes = Math.floor((timeleft % (1000 * 60 * 60)) / (1000 * 60))
    const seconds = Math.floor((timeleft % (1000 * 60)) / 1000)
    const milliseconds = Math.floor(timeleft % 1000)

    daysElement.innerHTML = days + 'd'
    hoursElement.innerHTML = hours + 'h'
    minsElement.innerHTML = minutes + 'm'
    secsElement.innerHTML = seconds + 's'
    msElement.innerHTML = String(milliseconds).padStart(3, '0') + 'ms'

    if (timeleft < 0) {
      clearInterval(countdown)
      daysElement.innerHTML = '0d'
      hoursElement.innerHTML = '0h'
      minsElement.innerHTML = '0m'
      secsElement.innerHTML = '0s'
      msElement.innerHTML = '0ms'
    }
  }

  let countdown = setInterval(calculate, 1000)
  calculate()

  let timeout = 0
  let count = 0

  const logo = document.getElementById('logo')
  if (logo) {
    logo.onclick = () => {
      if (timeout) clearTimeout(timeout)

      count = count + 1
      if (count > 9) {
        count = 0

        msElement.classList.toggle('hidden')
        clearTimeout(countdown)

        const hidden = msElement.classList.contains('hidden')
        if (hidden) {
          countdown = setInterval(calculate, 1000)
        } else {
          countdown = setInterval(calculate, 5)
        }
      }

      timeout = setTimeout(() => {
        count = 0
      }, 200)
    }
  }
</script>
